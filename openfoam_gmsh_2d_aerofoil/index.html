<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ole Petersen">
<meta name="keywords" content="CFD, Openfoam, gmsh, 2d">

<title>CFD modeling of the flow behavior over NACA0012 airfoil</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">CFD modeling of the flow behavior over NACA0012 airfoil</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Ole Petersen </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Dec 18, 2022</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    <p>In this tutorial, I will show from end to end how to do a 2d CFD simulation of an aerofoil including the generation of the geometry, the meshing using <code>gmsh</code> and the simulation using <code>OpenFoam</code>.</p>
  </div>
</div>

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The starting point is the <a href="https://www.openfoam.com/documentation/guides/latest/doc/verification-validation-naca0012-airfoil-2d.html">NACA0012 tutorial case in OpenFoam</a>. Copy this case to your new working directory. In this tutorial, we will have a look at how to simulate your custom 2d geometry as the tutorial is intransparent about how the mesh was generated.</p>
</section>
<section id="mesh-generation" class="level1">
<h1>Mesh generation</h1>
<p>We will use <code>gmsh</code> to generate the mesh. To do so, we will first generate the geometry using <code>gmsh</code>’s geometry format, use the <code>gmsh</code> GUI to debug the geometry and finally generate the mesh.</p>
<section id="geometry-generation" class="level2">
<h2 class="anchored" data-anchor-id="geometry-generation">Geometry generation</h2>
<p>The geometry will look as follows:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/geometry.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Geometry of our simulation</figcaption><p></p>
</figure>
</div>
<p>The volume in which fluid is to be simulated is the whole body from which the aerofoil in the middle is cut out. The circle arc on the left is the inlet while the outlet is the rectangle on the right.<br>
The whole geometry generation is done in the <a href="case/mesh_generation.jl">mesh_generation.jl</a> script, which outputs a <code>gmsh</code> geometry file <a href="case/aerofoil.geo">aerofoil.geo</a> that <code>gmsh</code> can read. Note that <code>gmsh</code> has its own <a href="https://gmsh.info/doc/texinfo/gmsh.html">geometry scripting language</a>, but I found it easier to use a proper programming language like <code>julia</code> to generate the geometry.</p>
<section id="generating-the-profile" class="level3">
<h3 class="anchored" data-anchor-id="generating-the-profile">Generating the profile</h3>
<p>We will simulate a NACA0012 airfoil, which is described by the following equation: <span class="math display">\[
y(x) = \pm0.594689181*(0.298222773*\sqrt{x} - 0.127125232*x - 0.357907906*x^2 + 0.291984971*x^3 - 0.105174606*x^4)
\]</span> Now, we will generate a set of points that describe the profile:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">y</span>(x)<span class="op">=</span> <span class="fl">0.594689181</span><span class="fu">*</span>(<span class="fl">0.298222773</span><span class="fu">*sqrt</span>(x) <span class="op">-</span> <span class="fl">0.127125232</span><span class="op">*</span>x <span class="op">-</span> <span class="fl">0.357907906</span><span class="op">*</span>x<span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">0.291984971</span><span class="op">*</span>x<span class="op">^</span><span class="fl">3</span> <span class="op">-</span> <span class="fl">0.105174606</span><span class="op">*</span>x<span class="op">^</span><span class="fl">4</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>n_points_per_side<span class="op">=</span><span class="fl">10</span> <span class="co"># this would be much higher in the real case</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>n_aerofoil_points<span class="op">=</span><span class="fl">2</span><span class="op">*</span>n_points_per_side</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>io<span class="op">=</span><span class="cn">stdout</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n_points_per_side</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span>(i<span class="op">-</span><span class="fl">1</span>)<span class="op">/</span>(n_points_per_side)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    mesh_size<span class="op">=</span><span class="fl">0.005</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(io,<span class="st">"Point(</span><span class="sc">$</span>i<span class="st">) = {</span><span class="sc">$</span>x<span class="st">, </span><span class="sc">$</span>(<span class="fu">y</span>(x))<span class="st">, 0.0,</span><span class="sc">$</span>mesh_size<span class="st">};"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n_points_per_side</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="fl">1</span><span class="fu">-</span>(i<span class="op">-</span><span class="fl">1</span>)<span class="op">/</span>(n_points_per_side)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    mesh_size<span class="op">=</span><span class="fl">0.005</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span>(io,<span class="st">"Point(</span><span class="sc">$</span>(i<span class="op">+</span>n_points_per_side)<span class="st">) = {</span><span class="sc">$</span>(x)<span class="st">, </span><span class="sc">$</span>(<span class="fu">-y</span>(x))<span class="st">, 0.0,</span><span class="sc">$</span>mesh_size<span class="st">};"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Point(1) = {0.0, 0.0, 0.0,0.005};
Point(2) = {0.1, 0.046561895043862704, 0.0,0.005};
Point(3) = {0.2, 0.056968557150769476, 0.0,0.005};
Point(4) = {0.3, 0.05948422462775665, 0.0,0.005};
Point(5) = {0.4, 0.05738266105317275, 0.0,0.005};
Point(6) = {0.5, 0.05219019673131475, 0.0,0.005};
Point(7) = {0.6, 0.04479110070446828, 0.0,0.005};
Point(8) = {0.7, 0.03570927685952479, 0.0,0.005};
Point(9) = {0.8, 0.025211311562171167, 0.0,0.005};
Point(10) = {0.9, 0.013352458679209828, 0.0,0.005};
Point(11) = {1.0, 1.650594053104193e-17, 0.0,0.005};
Point(12) = {0.9, -0.013352458679209828, 0.0,0.005};
Point(13) = {0.8, -0.025211311562171167, 0.0,0.005};
Point(14) = {0.7, -0.03570927685952479, 0.0,0.005};
Point(15) = {0.6, -0.04479110070446828, 0.0,0.005};
Point(16) = {0.5, -0.05219019673131475, 0.0,0.005};
Point(17) = {0.4, -0.05738266105317275, 0.0,0.005};
Point(18) = {0.30000000000000004, -0.05948422462775666, 0.0,0.005};
Point(19) = {0.19999999999999996, -0.05696855715076947, 0.0,0.005};
Point(20) = {0.09999999999999998, -0.046561895043862704, 0.0,0.005};</code></pre>
</div>
</div>
<p>The syntax is <code>Point(i) = {x, y, z, mesh_size};</code> where <code>i</code> is a unique index of the point, <code>x</code>, <code>y</code> and <code>z</code> are the coordinates and <code>mesh_size</code> is the desired mesh size at this point. Pasting this output into a file called <code>aerofoil.geo</code> (or setting the script up to write its output to that file like in the <a href="case/mesh_generation.jl">final version</a> and running <code>gmsh aerofoil.geo</code> will prompt you with the following:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/raw_profile.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Profile points</figcaption><p></p>
</figure>
</div>
<p>The next critical step is to connect all the points with a spline. The profile points should be connected with a single spline instead of a set of hundreds of single lines since this will later enable us to name the aerofoil surface. This is done by the following code:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(io,<span class="st">"""Spline(1)={1:</span><span class="sc">$</span>n_aerofoil_points<span class="st">,1};"""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Spline(1)={1:20,1};</code></pre>
</div>
</div>
<p>The syntax is <code>Spline(i)={p1,p2,...pk};</code> where <code>i</code> is a unique index of the spline and <code>pi</code> are the indices of the points the spline should connect. <code>pi:pj</code> is a shorthand for <code>pi,pi+1,...,pj</code>. The <code>1</code> at the end of the line is the first index again, which is needed to close the spline. The result is the following:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/splined_profile.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Profile with spline</figcaption><p></p>
</figure>
</div>
</section>
<section id="generating-the-bounding-box" class="level3">
<h3 class="anchored" data-anchor-id="generating-the-bounding-box">Generating the bounding box</h3>
<p>The next step is to generate the bounding box. This is done by the following code:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>bounding_radius<span class="op">=</span><span class="fl">5.0</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>far_field_mesh_size<span class="op">=</span><span class="fl">0.3</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(io,<span class="st">"Point(</span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">1</span>)<span class="st">) = {0.0, </span><span class="sc">$</span>(bounding_radius)<span class="st">, 0.0, </span><span class="sc">$</span>far_field_mesh_size<span class="st">};"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(io,<span class="st">"Point(</span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">2</span>)<span class="st">) = {0.0, </span><span class="sc">$</span>(<span class="op">-</span>bounding_radius)<span class="st">, 0.0, </span><span class="sc">$</span>far_field_mesh_size<span class="st">};"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(io,<span class="st">"Point(</span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">3</span>)<span class="st">) = {</span><span class="sc">$</span>(<span class="op">-</span>bounding_radius)<span class="st">, 0.0, 0.0, </span><span class="sc">$</span>far_field_mesh_size<span class="st">};"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(io,<span class="st">"Point(</span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">4</span>)<span class="st">) = {</span><span class="sc">$</span>(bounding_radius)<span class="st">, </span><span class="sc">$</span>(bounding_radius)<span class="st">, 0.0, </span><span class="sc">$</span>far_field_mesh_size<span class="st">};"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(io,<span class="st">"Point(</span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">5</span>)<span class="st">) = {</span><span class="sc">$</span>(bounding_radius)<span class="st">, </span><span class="sc">$</span>(<span class="op">-</span>bounding_radius)<span class="st">, 0.0, </span><span class="sc">$</span>far_field_mesh_size<span class="st">};"</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(io,<span class="st">"Circle(</span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">1</span>)<span class="st">)= {</span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">2</span>)<span class="st">, 1, </span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">3</span>)<span class="st">};"</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(io,<span class="st">"Circle(</span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">2</span>)<span class="st">)= {</span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">3</span>)<span class="st">, 1, </span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">1</span>)<span class="st">};"</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(io,<span class="st">"Line(</span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">3</span>)<span class="st">) = {</span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">1</span>)<span class="st">, </span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">4</span>)<span class="st">};"</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(io,<span class="st">"Line(</span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">4</span>)<span class="st">) = {</span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">4</span>)<span class="st">, </span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">5</span>)<span class="st">};"</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(io,<span class="st">"Line(</span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">5</span>)<span class="st">) = {</span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">5</span>)<span class="st">, </span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">2</span>)<span class="st">};"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Point(21) = {0.0, 5.0, 0.0, 0.3};
Point(22) = {0.0, -5.0, 0.0, 0.3};
Point(23) = {-5.0, 0.0, 0.0, 0.3};
Point(24) = {5.0, 5.0, 0.0, 0.3};
Point(25) = {5.0, -5.0, 0.0, 0.3};
Circle(21)= {22, 1, 23};
Circle(22)= {23, 1, 21};
Line(23) = {21, 24};
Line(24) = {24, 25};
Line(25) = {25, 22};</code></pre>
</div>
</div>
<p>You can look up the exact syntax of the commands in the <a href="https://gmsh.info/doc/texinfo/gmsh.html">Gmsh documentation</a>. The result is the following:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/bounding_box_2d.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Profile with bounding box</figcaption><p></p>
</figure>
</div>
<p>Next, we want to create a surface that fills the area between the aerofoil and the bounding box. This is done by the following code:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(io,<span class="st">"Curve Loop(2) = {</span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">1</span>)<span class="st">:</span><span class="sc">$</span>(n_aerofoil_points<span class="op">+</span><span class="fl">5</span>)<span class="st">};"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(io,<span class="st">"Curve Loop(3) = {1};"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(io,<span class="st">"Plane Surface(1) = {2,3};"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Curve Loop(2) = {21:25};
Curve Loop(3) = {1};
Plane Surface(1) = {2,3};</code></pre>
</div>
</div>
<p>We join a set of lines to a loop with <code>Curve Loop(i) = {p1,p2,...pk};</code> where <code>i</code> is a unique index of the loop and <code>pi</code> are the indices of the lines the loop should connect. Loop <code>2</code> is the bounding box and loop <code>3</code> is the aerofoil. We then join the loops to a surface with <code>Plane Surface(i) = {l1,l2,...lk};</code> where <code>i</code> is a unique index of the surface and <code>li</code> are the indices of the loops the surface should connect. This does not make a visual difference.</p>
</section>
<section id="extruding-the-geometry" class="level3">
<h3 class="anchored" data-anchor-id="extruding-the-geometry">Extruding the geometry</h3>
<p>OpenFoam does not allow us to use 2D geometries, so we need to extrude the geometry in the z-direction. This is done by the following code:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span>(io,<span class="st">"""</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="st">meshThickness=1.0;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="st">surfaceVector[] = Extrude {0, 0, meshThickness} {</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="st">    Surface{1};</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="st">    Layers{1};</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="st">    Recombine;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="st">};</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="st">Physical Volume("internalField") = surfaceVector[1];</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="st">Physical Surface("frontAndBackPlanes") = {surfaceVector[0],1};</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="st">Physical Surface("INLET")={surfaceVector[2],surfaceVector[3]};</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="st">Physical Surface("OUTLET")={surfaceVector[5]};</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="st">Physical Surface("AIRFOIL")={surfaceVector[7]};</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="st">Physical Surface("WALL")={surfaceVector[4],surfaceVector[6]};</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>meshThickness=1.0;
surfaceVector[] = Extrude {0, 0, meshThickness} {
    Surface{1};
    Layers{1};
    Recombine;
};
Physical Volume("internalField") = surfaceVector[1];
Physical Surface("frontAndBackPlanes") = {surfaceVector[0],1};
Physical Surface("INLET")={surfaceVector[2],surfaceVector[3]};
Physical Surface("OUTLET")={surfaceVector[5]};
Physical Surface("AIRFOIL")={surfaceVector[7]};
Physical Surface("WALL")={surfaceVector[4],surfaceVector[6]};
</code></pre>
</div>
</div>
<p>We extrude in the direction of the vector <code>{0,0,meshThickness}</code> with <code>Extrude {0, 0, meshThickness} {Surface{1};Layers{1};Recombine;};</code>. <code>Surface{1};</code> tells <code>gmsh</code> we want to extrude the surface with the index one we just created. The <code>Layers{1}</code> command tells Gmsh to only generate one mesh layer. The <code>Recombine</code> command does something I do not understand but is recommended in other tutorials.</p>
<p>Finally, we need to assign names to surfaces in order to be able to later set boundary conditions in OpenFoam. The keyword <code>Physical</code> means that a name needs to be exported to the mesh. The syntax is <code>Physical Surface{"name_i_choose"}={p1,p2,...pk};</code> where <code>p1,p2,...pk</code> are the indices of the surfaces we want to assign the name to. The same holds for volumes. The names we choose are <code>frontAndBackPlanes</code>, <code>INLET</code>, <code>OUTLET</code>, <code>AIRFOIL</code> and <code>WALL</code>. The names are not important, but they need to be consistent with the names we use in OpenFoam. The <code>Extrude</code> command returns a list of surfaces it created by the extrusion as well as the volume it created. The ordering of these values is described by the <a href="https://gmsh.info/doc/texinfo/gmsh.html#Extrusions">docs</a> as follows:</p>
<blockquote class="blockquote">
<p>By default, the list contains the “top” of the extruded entity at index 0 and the extruded entity at index 1, followed by the “sides” of the extruded entity at indices 2, 3, etc.</p>
</blockquote>
<p>Now you see why it is important the aerofoil consists of only one loop: Else we would have to assign a few hundred surfaces to a physical surface now. Even now the assignment is not trivial, but you can either try to keep track of the order in which the lines were added to the extrusion or use the visibility tool in <code>gmsh</code>, go to the tree view, select only one physical surface and click <code>Apply</code>. This will show you if you assigned the physical surface to the correct surfaces.</p>
</section>
</section>
<section id="meshing-the-geometry" class="level2">
<h2 class="anchored" data-anchor-id="meshing-the-geometry">Meshing the geometry</h2>
<p>Now we have the geometry ready to be meshed. Running the geometry generation script will create a file <code>aerofoil.geo</code> in the current directory. We can now run <code>gmsh</code> on this file to create the mesh:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">julia</span> mesh_generation.jl</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">gmsh</span> <span class="at">-3</span> aerofoil.geo <span class="at">-format</span> msh2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here, the <code>-3</code> flag tells <code>gmsh</code> to create a 3D mesh. The <code>-format msh2</code> flag tells <code>gmsh</code> to create a mesh in the <code>msh2</code> format instead of the newest <code>msh4</code> format. This is necessary since else we will not be able to convert the mesh to the <code>OpenFoam</code> format, resulting in hard-to-debug errors. The resulting mesh file <code>aerofoil.msh</code> can be viewed by typing <code>gmsh aerofoil.msh</code> in the terminal. The result should look like this:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mesh.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Mesh</figcaption><p></p>
</figure>
</div>
<p>However, you might realize the cells in this mesh have a triangular cross-section. My experience is that this is less numerically stable in practice. Therefore I added</p>
<pre class="{text}"><code>Recombine Surface{1};</code></pre>
<p>to the <code>gmsh</code> geometry. This causes neighbouring triangular cells to be recombined into more effective shapes. The result looks like this:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/mesh_reconbined.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Recombined mesh</figcaption><p></p>
</figure>
</div>
</section>
<section id="converting-the-mesh-to-openfoam-format" class="level2">
<h2 class="anchored" data-anchor-id="converting-the-mesh-to-openfoam-format">Converting the mesh to OpenFoam format</h2>
<p>Now we have the mesh in the <code>msh2</code> format by running</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load OpenFoam into context</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> /opt/OpenFOAM/OpenFOAM-10/etc/bashrc</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="ex">gmshToFoam</span> aerofoil.msh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This will create a directory <code>constant/polyMesh</code> with the mesh in the <code>OpenFoam</code> format. Now have a look at the <code>constanc/boundary</code> file. It should look like this:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode txt code-with-copy"><code class="sourceCode default"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>FoamFile</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    format          ascii;</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    class           polyBoundaryMesh;</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    location        "constant/polyMesh";</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    object          boundary;</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>5 // entry0</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    frontAndBackPlanes</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>        type            patch;</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        physicalType    patch;</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        nFaces          33288;</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>        startFace       24701;</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    INLET</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        type            patch;</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>        physicalType    patch;</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>        nFaces          54;</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>        startFace       57989;</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    WALL</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>        type            patch;</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>        physicalType    patch;</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>        nFaces          34;</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>        startFace       58043;</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    OUTLET</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>        type            patch;</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>        physicalType    patch;</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>        nFaces          34;</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>        startFace       58077;</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>    AIRFOIL</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>        type            patch;</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>        physicalType    patch;</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>        nFaces          408;</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>        startFace       58111;</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we need to assign the types of the <code>frontAndBackPlanes</code> to <code>empty</code>, telling <code>OpenFoam</code> that the geometry is “pseudo-2d” and that of the <code>AIRFOIL</code> to <code>wall</code>. We can do this either by editing the file manually or by running</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span><span class="fu"> setBoundaryType</span> <span class="kw">{</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="ex">foamDictionary</span> constant/polyMesh/boundary <span class="at">-entry</span> entry0/<span class="va">$1</span>/type <span class="at">-set</span> <span class="va">$2</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="ex">setBoundaryType</span> frontAndBackPlanes empty</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="ex">setBoundaryType</span> AIRFOIL wall </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And now we have our mesh!</p>
</section>
</section>
<section id="setting-boundary-conditions" class="level1">
<h1>Setting boundary conditions</h1>
<p>Boundary conditions are set in the <code>0</code> directory. Here we reference the names we gave to the physical surfaces earlier and set values accordingly. For example the velocity boundary conditions are set as follows:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode txt code-with-copy"><code class="sourceCode default"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>//0/U</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>FoamFile</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    format          ascii;</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    class           volVectorField;</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    object          U;</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>dimensions      [ 0 1 -1 0 0 0 0 ];</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>angle           10;</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>magnitude       51.4815;</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>radAngle        #calc "degToRad($angle)";</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>internalField   uniform ( #calc "$magnitude*cos($radAngle)" #calc "$magnitude*sin($radAngle)" 0 );</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>boundaryField</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    INLET</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>        type            freestreamVelocity;</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>        freestreamValue $internalField;</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    OUTLET</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>        type            freestreamVelocity;</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>        freestreamValue $internalField;</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    WALL</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>        type            freestreamVelocity;</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>        freestreamValue $internalField;</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    AIRFOIL</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>        type            noSlip;</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>    frontAndBackPlanes</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>        type            empty;</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>#calc</code> macro can be used to evaluate expressions and I use it to be able to set the angle of attack. For the other fields, have a look at the <a href="case/0">repository</a>.</p>
</section>
<section id="turbulence-models" class="level1">
<h1>Turbulence models</h1>
<p>I set up this case to work with the k-epsilon, k-omega and Spallart Allamars turbulence models. These use additional fields to model turbulence. The initial conditions for these fields are also set up in the [0-directory] (case/0). Since the <code>nut</code> field is shared between turbulence models, the boundary conditions must be changed when setting a turbulence model, uncomment the correct values in the file.</p>
</section>
<section id="running-the-simulation" class="level1">
<h1>Running the simulation</h1>
<p>Now we can run the simulation by running</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./Allclean</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">./Allrun</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>in the <code>case</code> directory. Now calling <code>paraFoam -builtin</code> will open a window with the results, here showing the pressure field at 10° angle of attack:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/pressure.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Pressure field</figcaption><p></p>
</figure>
</div>
</section>
<section id="postprocessing" class="level1">
<h1>Postprocessing</h1>
<p>Finally, we might want to compute force coefficients. To do so, we edit <code>system/controlDict</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode txt code-with-copy"><code class="sourceCode default"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>timePrecision   6;</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>runTimeModifiable true;</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>// here the new code starts</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>functions</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    calcForceCoefficients</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        type            forceCoeffs;</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        functionObjectLibs ( "libforces.so" );</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        enabled         true;</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        writeControl   outputTime;</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        p               p;</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>        U               U;</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        rhoInf 1.225;</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>        rho         rhoInf;</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>        CofR  (0 0 0);</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>        patches (AIRFOIL);</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>        liftDir (0 1 0);</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>        dragDir (1 0 0);</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>        magUInf 51.4815;</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>        pitchAxis       (0 0 1);</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>        lRef            1;</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>        Aref           1.0;</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We are specifying that force coefficients should be computed from the pressure and velocity fields at a certain density, the center of rotation is in the origin (for calculating rotation coefficients), we want to compute forces on the <code>AIRFOIL</code> patch/surface, the lift direction is in the y-direction, the drag direction is in the x-direction, the freestream velocity is 51.4815 m/s, the pitch axis is in the z-direction, the reference length is 1 m and the reference area is <span class="math inline">\(1m^2\)</span> (1m length, the extrusion depth is 1m). Now we can run the simulation again and the results will be written to <code>postProcessing/forceCoeffs/0/forceCoeffs.dat</code>. The results should look like this for an angle of attack of 10°:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode txt code-with-copy"><code class="sourceCode default"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a># Force coefficients</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a># liftDir     : (0.000000e+00 1.000000e+00 0.000000e+00)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a># dragDir     : (1.000000e+00 0.000000e+00 0.000000e+00)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a># pitchAxis   : (0.000000e+00 0.000000e+00 1.000000e+00)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a># magUInf     : 5.148150e+01</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a># lRef        : 1.000000e+00</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a># Aref        : 1.000000e+00</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a># CofR        : (0.000000e+00 0.000000e+00 0.000000e+00)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a># Time          Cm              Cd              Cl              Cl(f)           Cl(r)         </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>0               1.005199e-04    8.689213e-04    2.007876e-04    2.009136e-04    -1.260811e-07</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>50              2.035919e-01    -4.819210e-02   7.422555e-01    5.747196e-01    1.675359e-01</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>100             2.156512e-01    -7.982419e-02   8.268958e-01    6.290991e-01    1.977967e-01</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>150             1.989127e-01    -8.818876e-02   8.174411e-01    6.076333e-01    2.098078e-01</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>200             1.937071e-01    -9.057140e-02   8.183314e-01    6.028728e-01    2.154586e-01</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>250             1.982154e-01    -9.338277e-02   8.350128e-01    6.157218e-01    2.192910e-01</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>300             2.051837e-01    -9.658069e-02   8.551922e-01    6.327799e-01    2.224124e-01</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>350             2.116860e-01    -9.937373e-02   8.728818e-01    6.481269e-01    2.247549e-01</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>400             2.160577e-01    -1.015911e-01   8.854153e-01    6.587653e-01    2.266499e-01</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>450             2.185094e-01    -1.031260e-01   8.930907e-01    6.650547e-01    2.280360e-01</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>500             2.198577e-01    -1.040943e-01   8.976094e-01    6.686624e-01    2.289470e-01</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The coefficients are calculated at each time step of the solver (a time step is more of an iterative step since the simulation is steady). Note that the lift- and drag direction are not set according to the convention, normally the lift is perpendicular to the free stream velocity and not to the aerofoil. One can either fix this in the configuration or by rotating lift and drag by the angle of attack after the simulation, which is done here.</p>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="single-angle-of-attack" class="level2">
<h2 class="anchored" data-anchor-id="single-angle-of-attack">Single angle of attack</h2>
<p>The following <a href="case/run_at_angle.sh">script</a> runs the simulation at the angle of attack given in the argument:</p>
<pre class="{bash}"><code>#!/bin/bash
cd "$(dirname "$0")" # change into location of this script
echo "Running airfoil simulation at $1 degrees at location $(pwd)"
# source /opt/OpenFOAM/OpenFOAM-10/etc/bashrc
foamDictionary 0/U -entry angle -set $1
./Allclean
./Allrun
if [[ -z "${SILENT}" ]]; then
    paraFoam -builtin
fi</code></pre>
<p>It uses the <code>foamDirectory</code> command line utility to set the correct angle of attack (does work for all angles except <span class="math inline">\(0\)</span>), runs the case and opens paraFoam to display the result if the <code>SILENT</code> environment variable has not been set. The resuls my look like this:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/U_12.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Velocity field for 12° angle of attack</figcaption><p></p>
</figure>
</div>
<p>You can also use the <code>Filters-&gt;Common-&gt;Streamtracer</code> utility in paraFoam to generate streamlines:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/ST_fine_12.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Streamlines for 12° angle of attack</figcaption><p></p>
</figure>
</div>
</section>
<section id="characteristic-curves" class="level2">
<h2 class="anchored" data-anchor-id="characteristic-curves">Characteristic curves</h2>
<p>The following <a href="case/run_in_parallel.sh">script</a> runs the simulation at multiple angles of attack in parallel, copying results to a single file calles <code>allResults.dat</code>:</p>
<pre class="{bash}"><code>angles=(0.001 2.5 5 7.5 10 12 15 20 25 30)
./write_mesh_properties.sh

for angle in "${angles[@]}"; do
    cp -r . /tmp/airfoil_$angle
    SILENT=1 /tmp/airfoil_$angle/run_at_angle.sh $angle &amp;
done
trap "trap - SIGTERM &amp;&amp; kill -- -$$" SIGINT SIGTERM EXIT
wait
name=$(jq '.name' config.json | tr -d '"')
turbulence_model=$(jq '.turbulence_model' config.json | tr -d '"')
mkdir -p results/$turbulence_model
dir="results/$turbulence_model/$name"
rm -r $dir
mkdir $dir
cp config.json $dir/config.json
for angle in "${angles[@]}"; do
    echo -n -e "$angle\t\t" &gt;&gt; $dir/allResults.dat
    tail -n 1 /tmp/airfoil_$angle/postProcessing/calcForceCoefficients/0/forceCoeffs.dat &gt;&gt; $dir/allResults.dat
done</code></pre>
<p>It copies the case directory to a new temporary directory for each angle of attack, runs the <code>run_at_angle.sh</code> script, waits for all the simulations to finish and writes the last line of the <code>calcForceCoefficients</code> postprocessing output to a file called <code>allResults.dat</code>. The directory to write the results to is determined by the contents of the <a href="case/config.json">config.json</a> file which allows you to save the results for multiple configurations. <a href="case/write_mesh_properties.sh">write_esh_properties.sh</a> updates the config file with the current configuration of the mesh.</p>
<p>The results can be plotted like this:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DataFrames</span>,<span class="bu">CSV</span>, <span class="bu">JSON3</span>, <span class="bu">Plots</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>turbModels<span class="op">=</span><span class="fu">readdir</span>(<span class="st">"case/results"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>resultData<span class="op">::</span><span class="dt">Dict{String,Dict{String,DataFrame}}</span>=<span class="fu">Dict</span>()</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>configs<span class="op">::</span><span class="dt">Dict{String,Dict{String,Any}}</span>=<span class="fu">Dict</span>()</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> turbModel <span class="kw">in</span> turbModels</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    resultData[turbModel]<span class="op">=</span><span class="fu">Dict</span>()</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    configs[turbModel]<span class="op">=</span><span class="fu">Dict</span>()</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    result_names<span class="op">=</span><span class="fu">readdir</span>(<span class="st">"case/results/</span><span class="sc">$</span>turbModel<span class="st">"</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> result_name <span class="kw">in</span> result_names</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>        config<span class="op">=</span>JSON3.<span class="fu">read</span>(<span class="fu">read</span>(<span class="st">"case/results/</span><span class="sc">$</span>turbModel<span class="st">/</span><span class="sc">$</span>result_name<span class="st">/config.json"</span>))</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        configs[turbModel][result_name]<span class="op">=</span>config</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">#display(config["cells"])</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        dataString<span class="op">=</span><span class="fu">open</span>(<span class="fu">f-&gt;read</span>(f, <span class="dt">String</span>), <span class="st">"case/results/</span><span class="sc">$</span>turbModel<span class="st">/</span><span class="sc">$</span>result_name<span class="st">/allResults.dat"</span>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># remove whitespaces and replace them with commas</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        filteredString<span class="op">=</span><span class="fu">reduce</span>(dataString;init<span class="op">=</span><span class="st">""</span>) <span class="cf">do</span> l,r</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>          (r<span class="op">==</span><span class="ch">' '</span><span class="op">||</span>r<span class="op">==</span><span class="ch">'\t'</span>) ? (l[<span class="kw">end</span>]<span class="op">==</span><span class="ch">','</span> ? l <span class="op">:</span> l<span class="op">*</span><span class="st">","</span>) <span class="op">:</span> l<span class="op">*</span>r</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        liftData<span class="op">=</span>CSV.<span class="fu">File</span>(<span class="fu">IOBuffer</span>(filteredString), header<span class="op">=</span><span class="cn">false</span>) <span class="op">|&gt;</span> DataFrame <span class="op">|&gt;</span> <span class="dt">Matrix</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">#display(liftData)</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>        tangentCoeffs<span class="op">=</span>liftData[<span class="op">:</span>,<span class="fl">4</span>]</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>        normalCoeffs<span class="op">=</span>liftData[<span class="op">:</span>,<span class="fl">5</span>]</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>        angles<span class="op">=</span>liftData[<span class="op">:</span>,<span class="fl">1</span>]</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>        radAngles<span class="op">=</span><span class="fu">deg2rad</span>.(angles)</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>        liftCoeffs<span class="op">=</span><span class="fu">cos</span>.(radAngles)<span class="op">.*</span>normalCoeffs<span class="op">.-</span><span class="fu">sin</span>.(radAngles)<span class="op">.*</span>tangentCoeffs</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>        dragCoeffs<span class="op">=</span><span class="fu">sin</span>.(radAngles)<span class="op">.*</span>normalCoeffs<span class="op">.+</span><span class="fu">cos</span>.(radAngles)<span class="op">.*</span>tangentCoeffs</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>        df<span class="op">=</span><span class="fu">DataFrame</span>(angle<span class="op">=</span>angles, tangent_coefficient<span class="op">=</span>tangentCoeffs, normal_coefficient<span class="op">=</span>normalCoeffs, lift_coefficient<span class="op">=</span>liftCoeffs, drag_coefficient<span class="op">=</span>dragCoeffs)</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">#display(df)</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>        resultData[turbModel][result_name]<span class="op">=</span>df</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>p_lift<span class="op">=</span><span class="fu">plot</span>(label<span class="op">=</span><span class="st">"Lift coefficient"</span>, xlabel<span class="op">=</span><span class="st">"Angle of attack [deg]"</span>, ylabel<span class="op">=</span><span class="st">"\$C_L\$"</span>, title<span class="op">=</span><span class="st">"Lift coefficient for k-epsilon model"</span>, ylims<span class="op">=</span>(<span class="fl">0</span>,<span class="fl">1.5</span>))</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>plots<span class="op">=</span>[]</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (result_name, result) <span class="kw">in</span> resultData[<span class="st">"kEpsilon"</span>]</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot!</span>(p_lift,result.angle, result.lift_coefficient, label<span class="op">=</span>configs[<span class="st">"kEpsilon"</span>][result_name][<span class="st">"name"</span>])</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p_lift)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-7-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>You can see that the finest structured mesh did not converge.</p>
<p>Similarly, the drag coefficients can be plotted like this:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>p_drag<span class="op">=</span><span class="fu">plot</span>(label<span class="op">=</span><span class="st">"Drag coefficient"</span>, xlabel<span class="op">=</span><span class="st">"Angle of attack [deg]"</span>, ylabel<span class="op">=</span><span class="st">"\$C_D\$"</span>, title<span class="op">=</span><span class="st">"Drag coefficient for k-epsilon model"</span>, ylims<span class="op">=</span>(<span class="fl">0</span>,<span class="fl">1.5</span>))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>plots<span class="op">=</span>[]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (result_name, result) <span class="kw">in</span> resultData[<span class="st">"kEpsilon"</span>]</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot!</span>(p_drag,result.angle, result.drag_coefficient, label<span class="op">=</span>configs[<span class="st">"kEpsilon"</span>][result_name][<span class="st">"name"</span>])</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span>(p_drag)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="index_files/figure-html/cell-8-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>I hope this post made it a bit easier to understand how a 2D CFD simulation of an external flow can be performed using <code>OpenFoam</code> and <code>gmsh</code>!</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>